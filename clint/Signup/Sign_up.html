<!DOCTYPE html>
<html lang="bn">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Signup Form</title>
    <style>
        * {
    box-sizing: border-box;
    padding: 0;
    margin: 0;
}

body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(120deg, #e0f7fa, #fff);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.signup-container {
    width: 100%;
    max-width: 500px;
    background: white;
    padding: 25px 30px;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.signup-container h2 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
}

form input,
form select {
    width: 100%;
    padding: 12px 10px;
    margin: 10px 0;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 15px;
}

form input:focus,
form select:focus {
    border-color: #28a745;
    outline: none;
}

form label {
    font-size: 14px;
    color: #555;
    margin-top: 10px;
    display: block;
}

button {
    width: 100%;
    padding: 14px;
    background-color: #28a745;
    color: white;
    font-size: 16px;
    margin-top: 15px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s ease;
}

button:hover {
    background-color: #218838;
}

/* Responsive Design */
@media (max-width: 480px) {
    .signup-container {
        padding: 20px;
    }

    form input,
    form select,
    button {
        font-size: 14px;
        padding: 10px;
    }
}
    </style>


</head>

<body>

    <div class="signup-container">
        <form id="signupForm">
            <h2>Sign Up</h2>

            <label for="name">Full Name</label>
            <input type="text" id="name" name="name" required />


            <label for="divisionSelect">Division</label>
            <select id="divisionSelect" name="Division" required>
                <option value="">-- Select a Division --</option>
            </select>


            <label for="districtSelect">District</label>
            <select id="districtSelect" name="District" disabled required>
                <option value="">-- Select a District --</option>
            </select>


            <label for="upazilaSelect">Upazila</label>
            <select id="upazilaSelect" name="upazila" disabled required>
                <option value="">-- Select an Upazila --</option>
            </select>

            <label for="mobile">Mobile Number (11 digits)</label>
            <input type="text" id="mobile" name="mobile" required />

            <label for="email">Email (must end with @gmail.com)</label>
            <input type="email" id="email" name="email" required />

            <label for="blood">Blood Group</label>
            <select id="blood" name="blood_group" required>
                <option value="">Select Blood Group</option>
                <option value="A+">A+</option>
                <option value="A-">A-</option>
                <option value="B+">B+</option>
                <option value="B-">B-</option>
                <option value="AB+">AB+</option>
                <option value="AB-">AB-</option>
                <option value="O+">O+</option>
                <option value="O-">O-</option>
            </select>

            <label for="password">Password</label>
            <input type="password" id="password" name="password" required />

            <label for="retype_password">Retype Password</label>
            <input type="password" id="retype_password" name="retype_password" required />

            <label for="last_donate_date">Last Donate Date</label>
            <input type="date" id="last_donate_date" name="last_donate_date" required />

            <button type="submit">Sign Up</button>
        </form>
    </div>


    <script>

        // Form validation
            const form = document.getElementById( "signupForm" );

            form.addEventListener( "submit", async function ( e )
            {
                e.preventDefault();

                const mobile = form.mobile.value.trim();
                const email = form.email.value.trim();
                const password = form.password.value;
                const retypePassword = form.retype_password.value;

                const isMobileValid = /^[0-9]{11}$/.test( mobile );
                const isEmailValid = email.endsWith( "@gmail.com" );

                if ( !isMobileValid )
                {
                    alert( "Mobile number must be exactly 11 digits." );
                    return;
                }

                // if ( !isEmailValid )
                // {
                //     alert( "Email must end with @gmail.com" );
                //     return;
                // }

                if ( password !== retypePassword )
                {
                    alert( "Passwords do not match." );
                    return;
                }

                const data = {};
                new FormData( form ).forEach( ( value, key ) => data[key] = value );

                try
                {
                    const response = await fetch( "http://localhost:4341/api/signup", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify( data )
                    } );

                    const result = await response.json();

                    if ( response.ok )
                    {

                        localStorage.setItem( "email", result.email );
                        window.location.href = "../otp/otp_verify.html";

                    } else
                    {
                        alert( result.message || "Something went wrong!" );
                    }

                } catch ( error )
                {
                    console.error( "Signup failed:", error );
                    alert( "Signup failed. Try again later." );
                }

            } );

            // ========================
            // বিভাগ, জেলা, উপজেলা লজিক
            // ========================
            let divisions = [];

            const divisionSelect = document.getElementById( 'divisionSelect' );
            const districtSelect = document.getElementById( 'districtSelect' );
            const upazilaSelect = document.getElementById( 'upazilaSelect' );

            function loadData()
            {
                fetch( 'http://localhost:4341/api/location_data' )
                    .then( res =>
                    {
                        if ( !res.ok ) throw new Error( 'Failed to load data' );
                        return res.json();
                    } )
                    .then( jsonData =>
                    {
                        divisions = jsonData;
                        populateDivisions();
                    } )
                    .catch( err =>
                    {
                        console.error( err );
                        alert( 'Failed to load data' );
                    } );
            }

            function populateDivisions()
            {
                clearSelect( divisionSelect );
                addOption( divisionSelect, '', '-- Select a Division --' );
                divisions.forEach( div =>
                {
                    addOption( divisionSelect, div.name, div.name );
                } );
                districtSelect.disabled = true;
                upazilaSelect.disabled = true;
                clearSelect( districtSelect );
                clearSelect( upazilaSelect );
            }

            function populateDistricts( divisionName )
            {
                clearSelect( districtSelect );
                addOption( districtSelect, '', '-- Select a District --' );
                const division = divisions.find( d => d.name === divisionName );
                if ( division )
                {
                    division.districts.forEach( dist =>
                    {
                        addOption( districtSelect, dist.name, dist.name );
                    } );
                    districtSelect.disabled = false;
                } else
                {
                    districtSelect.disabled = true;
                }
                clearSelect( upazilaSelect );
                addOption( upazilaSelect, '', '-- Select an Upazila --' );
                upazilaSelect.disabled = true;
            }

            function populateUpazilas( divisionName, districtName )
            {
                clearSelect( upazilaSelect );
                addOption( upazilaSelect, '', '- Select an Upazila --' );
                const division = divisions.find( d => d.name === divisionName );
                if ( division )
                {
                    const district = division.districts.find( dist => dist.name === districtName );
                    if ( district )
                    {
                        district.upazilas.forEach( upz =>
                        {
                            addOption( upazilaSelect, upz, upz );
                        } );
                        upazilaSelect.disabled = false;
                    } else
                    {
                        upazilaSelect.disabled = true;
                    }
                }
            }

            function clearSelect( selectElem )
            {
                while ( selectElem.options.length > 0 )
                {
                    selectElem.remove( 0 );
                }
            }

            function addOption( selectElem, value, text )
            {
                const option = document.createElement( 'option' );
                option.value = value;
                option.text = text;
                selectElem.appendChild( option );
            }

            divisionSelect.addEventListener( 'change', e =>
            {
                const selectedDivision = e.target.value;
                if ( selectedDivision )
                {
                    populateDistricts( selectedDivision );
                } else
                {
                    districtSelect.disabled = true;
                    upazilaSelect.disabled = true;
                    clearSelect( districtSelect );
                    clearSelect( upazilaSelect );
                }
            } );

            districtSelect.addEventListener( 'change', e =>
            {
                const selectedDistrict = e.target.value;
                const selectedDivision = divisionSelect.value;
                if ( selectedDistrict )
                {
                    populateUpazilas( selectedDivision, selectedDistrict );
                } else
                {
                    upazilaSelect.disabled = true;
                    clearSelect( upazilaSelect );
                }
            } );

            //window.onload = loadData;
            document.addEventListener( "DOMContentLoaded", loadData );

            
    </script>

</body>

</html>


